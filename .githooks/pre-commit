#!/bin/sh

echo "üîç Running code quality checks..."
echo ""

# Run PHP CS Fixer check
echo "üìù Checking code style with PHP CS Fixer..."
docker compose exec -T php composer cs-check
CS_FIXER_EXIT=$?

if [ $CS_FIXER_EXIT -ne 0 ]; then
    echo ""
    echo "‚ùå PHP CS Fixer found issues!"
    echo "üí° Run 'docker compose exec php composer cs-fix' to fix them"
    echo ""
fi

# Run Rector check
echo ""
echo "üîß Checking code with Rector..."
docker compose exec -T php composer rector-check
RECTOR_EXIT=$?

if [ $RECTOR_EXIT -ne 0 ]; then
    echo ""
    echo "‚ùå Rector found issues!"
    echo "üí° Run 'docker compose exec php composer rector-fix' to fix them"
    echo ""
fi

# Exit with error if any check failed
if [ $CS_FIXER_EXIT -ne 0 ] || [ $RECTOR_EXIT -ne 0 ]; then
    echo "‚ùå Commit aborted due to code quality issues"
    echo ""
    exit 1
fi

echo ""
echo "‚úÖ All checks passed!"
echo ""
exit 0

